---
title: Bun.serve
description: How to use gau with a plain Bun.serve HTTP server.
---

import { Steps, Tabs, TabItem } from '@astrojs/starlight/components'
import FileTree from 'starlight-plugin-icons/components/FileTree.astro'
import Aside from 'starlight-plugin-icons/components/Aside.astro'

This guide shows how to use `gau` with a backend-only Bun server using `Bun.serve`.

Bun's docs: [Bun.serve](https://bun.com/docs/api/http).

<br />

<Steps>
1. ##### Follow the basic setup

   Complete the [Getting Started](/guides/getting-started) guide for installation, environment variables, and adding at least one OAuth provider.

2. ##### Create your auth configuration

   Define your `createAuth` configuration.

   ```ts title="src/auth.ts"
   import process from 'node:process'
   import { MemoryAdapter } from '@rttnd/gau/adapters/memory'
   import { createAuth } from '@rttnd/gau/core'
   import { GitHub, Google } from '@rttnd/gau/oauth'

   export const auth = createAuth({
     adapter: MemoryAdapter(),
     providers: [
       GitHub({
         clientId: process.env.AUTH_GITHUB_ID!,
         clientSecret: process.env.AUTH_GITHUB_SECRET!,
       }),
       Google({
         clientId: process.env.AUTH_GOOGLE_ID!,
         clientSecret: process.env.AUTH_GOOGLE_SECRET!,
       }),
     ],
     jwt: {
       secret: process.env.AUTH_SECRET!,
     },
     // When frontend runs on a different origin, set the trusted hosts, example:
     // trustHosts: ['http://localhost:5173', 'http://localhost:3000'],
   })

   export type Auth = typeof auth
   ```

   <Aside type="note">
     `gau` handles CORS and CSRF. For cross-origin setups, configure [`trustHosts`](/guides/configuration#trusthosts) in `createAuth`.
   </Aside>

3. ##### Start a Bun.serve HTTP server

   `createHandler(auth)` returns a standard Fetch handler. You can use it directly inside `Bun.serve`.

    ```ts title="server.ts"
    import { auth } from './src/auth'
    import { createHandler } from '@rttnd/gau/core'

    const handler = createHandler(auth)

    const server = Bun.serve({
      routes: {
        '/api/auth/*': req => handler(req),
        '/': new Response('OK'),
      },
    })

    console.log(`Server listening on ${server.url.hostname}:${server.url.port}`)
    ```

4. ##### Try it

    Look at the [Bun Example](https://github.com/Rettend/gau/tree/main/packages/example-bun).

5. ##### File Structure (example)

    <FileTree>
      - src
        - auth.ts
        - index.ts
      - package.json
    </FileTree>

</Steps>

#### Notes

   - By default, sessions use cookies when possible. If `redirectTo` points to a different origin (or a custom scheme for native apps), `gau` automatically returns the session token in the URL hash.
   - You can force strategies via `session.strategy: 'cookie' | 'token'` in `createAuth`.
